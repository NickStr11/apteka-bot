"""Test product extraction."""
import sys
sys.path.insert(0, 'src')

from extractors.products import extract_products, extract_total, format_products_for_notification

# Sample text from email (markdown table format)
sample_text = """
–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:

–¢–æ–≤–∞—Ä| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å| –ö–æ–ª-–≤–æ| –¶–µ–Ω–∞ –¥–ª—è –∞–ø—Ç–µ–∫–∏| –°—É–º–º–∞ –¥–ª—è –∞–ø—Ç–µ–∫–∏| –¶–µ–Ω–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞| –°—É–º–º–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞| –®–ö
---|---|---|---|---|---|---|---
–ö–ê–†–í–ï–î–ò–õ–û–õ –ö–ê–ù–û–ù 0,025 N30 –¢–ê–ë–õ| –ö–∞–Ω–æ–Ω—Ñ–∞—Ä–º–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –ó–ê–û| 2| 122,82| 245,64| 133,26| 266,52| 4606486019206
–ú–ï–¢–§–û–†–ú–ò–ù 0,85 N60 –¢–ê–ë–õ –ë–ê–ù–ö–ê| –û–ó–û–ù –û–û–û| 1| 140,35| 140,35| 152,28| 152,28| 4660153656521
–ü–û–õ–û–°–ö–ê –°–ê–¢–ï–õ–õ–ò–¢ –ü–õ–Æ–° –ü–ö–ì3-02.4 N50| –ö–û–ú–ü–ê–ù–ò–Ø –≠–õ–¢–ê –û–û–û| 1| 490,36| 490,36| 532,04| 532,04| 4612750380026
–¢–ï–ú–ü–ê–õ–ì–ò–ù N20 –¢–ê–ë–õ –ü/–ü–õ–ï–ù/–û–ë–û–õ–û–ß| –°–æ—Ñ–∞—Ä–º–∞ –ê–û| 1| 228,72| 228,72| 248,16| 248,16| 3800010643412
–ò–¢–û–ì–û:| | | | 1105,07| | 1199|

–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞: +79886689915
"""

print("–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤:")
print("="*60)

products = extract_products(sample_text)
for p in products:
    print(f"üì¶ {p.name}")
    print(f"   –ö–æ–ª-–≤–æ: {p.quantity}, –¶–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞: {p.price_client}‚ÇΩ, –°—É–º–º–∞: {p.total_client}‚ÇΩ")
    print()

total_pharm, total_client = extract_total(sample_text)
print(f"üí∞ –ò—Ç–æ–≥–æ –¥–ª—è –∞–ø—Ç–µ–∫–∏: {total_pharm}‚ÇΩ")
print(f"üí∞ –ò—Ç–æ–≥–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞: {total_client}‚ÇΩ")

print("\n" + "="*60)
print("–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:")
print("="*60)
print(format_products_for_notification(products, total_client))
